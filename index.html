<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AURA | Discipline Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #1F2328;             
            --card-bg: #2F343A;        
            --border: #394049;         
            --text-main: #E5E7EB;      
            --text-dim: #8A8F94;       
            --red: #fb7185;
            --green: #4ade80;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-font-smoothing: antialiased; touch-action: manipulation; }
        body { background: var(--bg); color: var(--text-main); height: 100vh; width: 100vw; overflow: hidden; }

        .pro-active .card, .pro-active .nav-btn.active, .pro-active .btn-main { font-family: 'JetBrains Mono', monospace !important; }

        /* NAV & SHELL */
        .nav-bar { position: fixed; top: 16px; left: 50%; transform: translateX(-50%); z-index: 1000; background: var(--card-bg); padding: 4px; border-radius: 20px; border: 1px solid var(--border); display: flex; gap: 4px; }
        .nav-btn { padding: 8px 18px; border-radius: 16px; border: none; color: var(--text-dim); background: transparent; font-size: 0.7rem; font-weight: 700; cursor: pointer; }
        .nav-btn.active { background: var(--text-main); color: var(--bg); }
        .app-shell { height: 100vh; padding: 100px 16px 40px; max-width: 420px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; }
        
        .card { width: 100%; background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 24px; position: relative; overflow: hidden; }
        .free-active .pro-feature { opacity: 0.15; pointer-events: none; filter: blur(3px); }

        /* SWIPE TIMER DESIGN */
        .timer-container { 
            padding: 40px 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            cursor: ns-resize; /* Cursor icon untuk indikasi swipe */
            user-select: none;
        }
        #timer-display { 
            font-family: 'JetBrains Mono'; 
            font-size: 4.5rem; 
            font-weight: 400; 
            letter-spacing: -3px; 
            color: var(--text-main); 
            transition: transform 0.1s ease;
        }
        .swipe-hint { font-size: 0.55rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 2px; margin-bottom: -10px; }

        .btn-main { width: 100%; padding: 18px; border-radius: 20px; border: none; font-size: 0.85rem; font-weight: 800; background: var(--text-main); color: var(--bg); cursor: pointer; }
        
        /* STATUS TAGS */
        .status-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .status-tag { font-size: 0.65rem; font-weight: 700; padding: 4px 12px; border-radius: 8px; background: var(--border); color: var(--text-dim); }
        .tag-on { background: rgba(74, 222, 128, 0.15); color: var(--green); }
        .tag-off { background: rgba(251, 113, 133, 0.15); color: var(--red); }
        .tag-broken { background: #4c1d1d; color: #f87171; }

        /* OVERLAYS */
        #finish-notice { position: absolute; inset: 0; background: var(--card-bg); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        #delay-overlay { position: fixed; inset: 0; background: rgba(31,35,40,0.98); z-index: 9000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; }
        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 25px; }
        #intro-overlay { display: flex; background: rgba(31, 35, 40, 0.98); backdrop-filter: blur(15px); }
        #intro-modal { background: var(--card-bg); border: 1px solid var(--border); border-radius: 32px; padding: 35px 25px; width: 100%; max-width: 350px; text-align: center; }
        .btn-sub { width: 100%; padding: 12px; border-radius: 15px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); font-size: 0.7rem; font-weight: 700; margin-top: 10px; cursor: pointer; }
    </style>
</head>
<body class="free-active">

    <div id="lofi-player" style="position: absolute; width: 0; height: 0; opacity: 0; pointer-events: none;"></div>

    <div id="intro-overlay" class="overlay">
        <div id="intro-modal">
            <h2 style="font-size: 1.3rem; font-weight: 800;">Upgrade to Productivity</h2>
            <div style="font-size: 0.7rem; color: var(--text-dim); margin-top: 4px;">Aktifkan kontrol fokus penuh.</div>
            <button class="btn-main" onclick="buyPro()" style="background: white; color: black; margin-top: 20px;">DAPATKAN AKSES â€” Rp 15.000</button>
            <button class="btn-sub" onclick="startTrial()">COBA DULU (30 MENIT)</button>
            <button class="btn-sub" style="border:none; opacity: 0.6;" onclick="enterApp('free')">Nanti saja</button>
        </div>
    </div>

    <div id="delay-overlay">
        <div id="delay-timer" style="font-size: 2rem; margin-bottom: 20px; font-family: 'JetBrains Mono';">3</div>
        <p style="font-size: 0.8rem; margin-bottom: 30px;">Tahan fokus lo sebentar lagi...</p>
        <button class="btn-main" onclick="cancelStop()">Lanjut</button>
        <button class="btn-sub" id="confirm-stop-btn" style="opacity: 0; pointer-events: none;" onclick="finalStop()">Gue nyerah</button>
    </div>

    <nav class="nav-bar">
        <button class="nav-btn active" id="nav-free" onclick="setPlan('free', this)">FREE</button>
        <button class="nav-btn" id="nav-pro" onclick="requestProAccess()">PRO ðŸ’Ž</button>
    </nav>

    <div class="app-shell">
        <div class="card pro-feature">
            <div class="status-row">
                <span style="font-size: 0.55rem; font-weight: 800; color: var(--text-dim); letter-spacing: 1.2px;">INTEGRITAS</span>
                <span id="day-status" class="status-tag">REHAT</span>
            </div>
            <div id="integrity-info" style="font-size: 0.65rem; color: var(--text-dim); margin-top: 4px;">Sistem standby.</div>
        </div>

        <main class="card">
            <div id="finish-notice">
                <b style="font-size: 0.9rem;">Sesi Selesai âœ¨</b>
                <button class="btn-sub" onclick="closeFinishNotice()" style="width: auto; padding: 8px 25px; margin-top: 15px;">Tutup</button>
            </div>

            <div id="start-assist" class="pro-feature" style="text-align: center;">"Mulai aja dulu."</div>

            <div class="timer-container" id="timer-area">
                <span class="swipe-hint" id="swipe-hint">Swipe Up/Down</span>
                <div id="timer-display">00:25:00</div>
            </div>

            <div class="pro-feature" style="font-size: 0.6rem; color: var(--green); text-align: center; margin-bottom: 15px; font-weight: 700;">
                DEEP FOCUS AUDIO ACTIVE
            </div>

            <button class="btn-main" id="start-btn" onclick="initStart()">MULAI SEKARANG</button>
            
            <div id="running-controls" style="display: none; margin-top: 10px;">
                <button class="btn-sub" style="width: 100%; border-color: var(--border);" onclick="handleStop()">Berhenti</button>
            </div>
        </main>
    </div>

    <script>
        let timeLeft = 1500, timer = null, mode = 'free', player;
        let startY = 0, isRunning = false;

        // --- SWIPE LOGIC ---
        const timerArea = document.getElementById('timer-area');
        
        timerArea.addEventListener('touchstart', e => { if(!isRunning) startY = e.touches[0].clientY; });
        timerArea.addEventListener('touchmove', e => {
            if(isRunning) return;
            const currentY = e.touches[0].clientY;
            const diff = startY - currentY;

            if (Math.abs(diff) > 10) { // Sensitivitas swipe
                if (diff > 0) timeLeft += 60; // Swipe Up: +1 Menit
                else if (timeLeft >= 60) timeLeft -= 60; // Swipe Down: -1 Menit
                
                startY = currentY;
                updateUI();
            }
        });

        // Fallback untuk mouse/desktop
        timerArea.addEventListener('wheel', e => {
            if(isRunning) return;
            if (e.deltaY < 0) timeLeft += 60;
            else if (timeLeft >= 60) timeLeft -= 60;
            updateUI();
        });

        function updateUI() {
            const h = Math.floor(timeLeft / 3600).toString().padStart(2, '0');
            const m = Math.floor((timeLeft % 3600) / 60).toString().padStart(2, '0');
            const s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${h}:${m}:${s}`;
        }

        // --- CORE LOGIC ---
        function initStart() {
            if(timeLeft <= 0) return;
            isRunning = true;
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('swipe-hint').style.display = 'none';
            document.getElementById('running-controls').style.display = 'block';
            if(mode === 'pro') { 
                updateDayStatus('ON'); 
                document.getElementById('integrity-info').innerText = "Fokus sedang terjaga.";
                if(player) player.playVideo();
            }
            timer = setInterval(() => {
                if(timeLeft > 0) { timeLeft--; updateUI(); }
                else finishSession();
            }, 1000);
        }

        function finishSession() {
            clearInterval(timer); isRunning = false;
            if(mode === 'pro') {
                localStorage.setItem('lastFocusDate', new Date().toDateString());
                if(player) player.pauseVideo();
            }
            document.getElementById('finish-notice').style.display = 'flex';
        }

        function closeFinishNotice() {
            document.getElementById('finish-notice').style.display = 'none';
            resetUI();
        }

        function resetUI() {
            clearInterval(timer); isRunning = false;
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('swipe-hint').style.display = 'block';
            document.getElementById('running-controls').style.display = 'none';
            timeLeft = 1500; // Reset ke 25 menit
            updateUI();
        }

        // --- UI & PLAN HELPERS ---
        function setPlan(p, btn) {
            mode = p;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.body.className = p + '-active';
            checkIntegrity();
        }

        function updateDayStatus(state) {
            const el = document.getElementById('day-status');
            el.innerText = state;
            el.className = 'status-tag tag-' + state.toLowerCase();
        }

        function checkIntegrity() {
            const lastDate = localStorage.getItem('lastFocusDate');
            if (!lastDate) return;
            const diff = (new Date(new Date().toDateString()) - new Date(lastDate)) / (1000 * 60 * 60 * 24);
            if (diff >= 1) {
                updateDayStatus('BROKEN');
                document.getElementById('integrity-info').innerText = "Integritas terputus kemarin.";
            }
        }

        // --- YOUTUBE & STOP LOGIC (Sama seperti sebelumnya) ---
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('lofi-player', {
                height: '0', width: '0', videoId: 'oPVte6aMprI',
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': 'oPVte6aMprI' }
            });
        }
        function requestProAccess() { if(mode==='free') document.getElementById('intro-overlay').style.display = 'flex'; }
        function buyPro() { document.getElementById('intro-overlay').style.display = 'none'; setPlan('pro', document.getElementById('nav-pro')); }
        function startTrial() { buyPro(); setTimeout(() => setPlan('free', document.getElementById('nav-free')), 1800000); }
        function cancelStop() { document.getElementById('delay-overlay').style.display = 'none'; }
        function handleStop() { 
            if(mode==='free') { resetUI(); return; }
            document.getElementById('delay-overlay').style.display = 'flex';
            setTimeout(() => { 
                document.getElementById('confirm-stop-btn').style.opacity = "1";
                document.getElementById('confirm-stop-btn').style.pointerEvents = "auto";
            }, 3000);
        }
        function finalStop() { document.getElementById('delay-overlay').style.display = 'none'; resetUI(); updateDayStatus('OFF'); }

        window.onload = checkIntegrity;
    </script>
</body>
</html>
